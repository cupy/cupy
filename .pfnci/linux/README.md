# Linux CI Scripts

This directory contains assets used for CI.

All tests here are isolated by Docker so that developers and contributors can reproduce the same environment as the CI.
You can use the `run.sh` tool to build the Docker image and run unit tests in the image.
The current (local) codebase is read-only mounted to the container and used for testing.

`./run.sh` takes a TARGET and one or more STAGEs as arguments.
Run `./run.sh` without arguments for the detailed usage and list of all STAGEs.

Here are some examples:

```
# Target: cuda114
# Stages: Build the docker image for testing, then run the unit test.
./run.sh cuda114 build test

# Target: rocm-4-2
# Stages: Only build the docker image.
./run.sh rocm-4-2 build
```

## Test Targets

`tests/` directory contains Dockerfiles and bootstrap shell scripts with TARGET name prefixed.
For example, when the target is `rocm-4-2`, `rocm-4-2.Dockerfile` and `rocm-4-2.sh` are used for testing.

These files are generated by the `generate.py` tool, except for the following targets:

* `cuda-rapids`: Run unit tests for components requiring RAPIDS (e.g., `cupyx.scipy.sparse.csgraph`).
* `array-api`: Run [array-api-tests](https://github.com/data-apis/array-api-tests) for `cupy.array_api` module.
